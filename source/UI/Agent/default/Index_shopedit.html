<!DOCTYPE html>
<html lang="en">
<head>
<title><#:C('sitename')#>--代理商平台</title>
<meta name="keywords" content="<#:C('keyword')#>"/>
<meta name="description" content="<#:C('content')#>"/>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<include file="Pub:Css"/>
</head>
<body>
<include file="Pub:top"/>
<include file="Pub:nav"/>
<!--main-container-part-->
<div id="content">
  <!--breadcrumbs-->
    <div id="content-header">
        <div id="breadcrumb">
            <a href="<#:U('index/index')#>" title="返回首页" class="tip-bottom"><i class="icon-home"></i>首页</a>
            <a href="#" class="current">编辑商户信息</a>
        </div>
        <h1>编辑商户信息</h1>
    </div>
    <!--End-breadcrumbs-->
    <div class="container-fluid" >
        <hr>
        <div class="row-fluid">
            <div class="span8">
                <div class="widget-box">
                    <div class="widget-title">
                        <span class="icon"><i class="icon-align-justify"></i></span>
                        <h5>编辑商户信息</h5>
                    </div>
                    <div class="widget-content nopadding">
                        <form name="" class="form-horizontal">
                            <div class="control-group">
                                <div class="alert span9" style="display: none;margin: 10px 0 10px 150px;">
                                    <span id="alertmsg"></span>
                                </div>
                            </div>    
                            <div class="control-group">
                                <label class="control-label">商户名称:</label>
                                <div class="controls">
                                    <input type="text" class="span11" data-toggle="tooltip" data-trigger="focus" title="商户名称不能超过20个字" data-placement="right" name="shopname" id="shopname" value="<#$shop.shopname#>"/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">联系人:</label>
                                <div class="controls">
                                    <input class="span11" type="text" name="linker" id="linker" value="<#$shop.linker#>" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">手机号码:</label>
                                <div class="controls">
                                    <input class="span11" type="text" name="phone" id="phone" value="<#$shop.phone#>"/>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">消费水平:</label>
                                <div class="controls">
                                    <volist name="enumdata.shoplevel" id="vo">
                                        <label class="checkbox">
                                            <input type="checkbox" value="<#$vo.key#>" name="shoplevel" <php>if(strpos($shop['shoplevel'],"#".$vo['key']."#")>-1){echo "checked";} </php>/><#$vo.txt#>
                                        </label>
                                    </volist>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">行业类别:</label>
                                <div class="controls">
                                    <volist name="enumdata.trades" id="vo">
                                        <label class="checkbox">
                                              <input type="radio" value="<#$vo.key#>" name="trade" <php>if($shop['trade']==$vo['key']){echo "checked";} </php>/><#$vo.txt#>
											 </label>
                                    </volist>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label">所属区域:</label>
                                <div class="controls">
                                    <select name="province" id="province" >
                                        
                                    </select>　　
                                    <select name="city" id="city" ><option value="市辖区">市辖区</option><option value="市辖县">市辖县</option></select>　　
                                    <select name="area" id="area" >
                                       
                                    </select>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">地址:</label>
                                    <div class="controls">
                                        <input class="span11" type="text"  data-toggle="tooltip" data-trigger="focus" title="输入地址信息" data-placement="right" name="address" id="address" value="<#$shop.address#>"/>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <input type="hidden" name="sid" id="sid" value="<#$shop.id#>">
                                    <input type="button"   class="btn btn-success"  id="btn_save" value="确认编辑" style="margin:20px;">
                               &nbsp;&nbsp;
                                    <input type="button"   class="btn btn-danger  " id="btn_back" value="返回列表">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="span4 column pull-right">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal  hide fade" id="myModal">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>
        <h3>提示信息</h3>
    </div>
    <div class="modal-body">
        <p>内容</p>
    </div>
    <div class="modal-footer">
        <a href="#" class="btn"  data-dismiss="modal">关闭</a>
    </div>
</div>
<script type="text/javascript">
  // This function is called from the pop-up menus to transfer to
  // a different page. Ignore if the value returned is a null string:
  function goPage (newURL) {

      // if url is empty, skip the menu dividers and reset the menu selection to default
      if (newURL != "") {
      
          // if url is "-", it is this page -- reset the menu:
          if (newURL == "-" ) {
              resetMenu();            
          } 
          // else, send page to designated URL            
          else {  
            document.location.href = newURL;
          }
      }
  }

// resets the menu selection upon entry to this page:
function resetMenu() {
   document.gomenu.selector.selectedIndex = 2;
}

function shownotice(t,obj){
    $('#notice-title').text(t);
    $('#notice-info').html($(obj).parent().next().html());
    $('#noticebox').modal({backdrop:false,show:true});
}
</script>

<script src="<#$Theme['P']['root']#>/matrix/js/jquery.ui.custom.js"></script> 
<script src="<#$Theme['P']['root']#>/matrix/js/matrix.js"></script> 
    <!-- scripts -->
    <script src="<#$Theme['P']['js']#>/jquery.js"></script>
    <script src="<#$Theme['P']['root']#>/bootadmin/js/bootstrap.min.js"></script>
    <script src="<#$Theme['P']['root']#>/bootadmin/js/theme.js"></script>
        <script src="<#$Theme['P']['root']#>/bootadmin/js/jquery.uniform.min.js"></script>
  <script src="<#$Theme['P']['root']#>/bootadmin/js/common.js"></script>
           <script src="<#$Theme['P']['js']#>/region_select.js"></script>
                    <script type="text/javascript">
                        new PCAS('province', 'city', 'area', '<#$shop['province']#>', '<#$shop.city#>', '<#$shop.area#>');
                    </script>
<!-- call this page plugins -->
    <script type="text/javascript">
        
         
        $(function () {
            
            // add uniform plugin styles to html elements
            $("input:checkbox, input:radio").uniform();
            $('#btn_back').bind('click',function(){
                location.href="<#:U('shoplist')#>";
            });
            //$(".alert").alert('close');
            $('#btn_save').bind('click',function(){

                var s=$('#shopname').val();
                var link=$('#linker').val();
                var phone=$('#phone').val();
                var pro=$('#province').val();
                var city=$('#city').val();
                var area=$('#area').val();
                var ad=$('#address').val();
                var sid=$('#sid').val();
                var shoplevel="";
                $("input[name='shoplevel']").each(function(){
                    if($(this).parent().hasClass('checked')){
                        shoplevel+="#"+$(this).val()+"#";
                    }
                });
                var trade="";
                $("input[name='trade']").each(function(){
                    if($(this).parent().hasClass('checked')){
                        trade=$(this).val();
                    }
                });
                

                  if (s == "") {
                      AlertTips("商户名称不能为空",1500);
                        return false;
                  }
                  if (link == "") {
                      
                      AlertTips("联系人不能为空",1500);
                        return false;
                  }
                 if(!isPhone(phone)){
    
                      AlertTips("请输入11位手机号码",1500);
                        return false;
                 }
                  $.ajax({
                        url: '<#:U('saveshop')#>',
                        type: "post",
                        data:{
                            'shopname':s,
                            'linker':link,
                            'phone':phone,
                            'province':pro,
                            'city':city,
                            'area':area,
                            'address':ad,
                            'shoplevel':shoplevel,
                            'trade':trade,
                            'id':sid,
                            '__hash__':$('input[name="__hash__"]').val()
                            },
                        dataType:'json',
                        error:function(){
            
                                AlertTips("服务器忙，请稍候再试",1500);
                                },
                        success:function(data){
                                
                                if(data.error==0){
                                    location.href=data.url;
                                }else{
                                    AlertTips(data.msg,1500);
                                }
                        }
                      });
                });
            
        });
    </script>
</body>
</html>
