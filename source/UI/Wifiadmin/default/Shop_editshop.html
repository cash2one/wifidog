<!DOCTYPE html>
<html>
<head>
	<title><#:C('sitename')#>-管理后台</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<include file="Pub:style"/>
	<!-- libraries -->
    <link href="<#$Theme['P']['root']#>/bootadmin/css/lib/uniform.default.css" type="text/css" rel="stylesheet" />
    <link href="<#$Theme['P']['root']#>/bootadmin/css/lib/select2.css" type="text/css" rel="stylesheet" />
    <link rel="stylesheet" href="<#$Theme['P']['root']#>/bootadmin/css/compiled/form-showcase.css" type="text/css" media="screen" />
	
<body>


<include file="Pub:Nav"/>
   <include file="Pub:Sidebar"/>

	<!-- main container -->
    <div class="content">
    	 <div class="container-fluid">
            <div id="pad-wrapper" class="form-page">
            	
                <div class="row-fluid form-wrapper">
                 		<div class="span12">
                            <h4>编辑商户信息</h4>
                        </div>
                    <!-- left column -->
                    <div class="span8 column">
                        <form name="">
                        <div class="alert span9" style="display: none;">
						  <span id="alertmsg"></span>
						</div>

						 <div class="field-box">
                                <label>所属代理商:</label>

								<div class="ui-select">
                               
							   <select name="pid" id="pid"><option value="-1">选择代理商</option>
                             <volist name="agent" id="vo">
							 <option value="<#$vo.id#>" <eq name="shop['pid']" value="$vo['id']">selected</eq>><#$vo.name#></option>
 

							 </volist>

							   </select> </div>
                            	
                            </div>
                            <div class="field-box">
                                <label>商户名称:</label>
                                <input class="span8" type="text"  data-toggle="tooltip" data-trigger="focus" title="商户名称不能超过20个字" data-placement="right" name="shopname" id="shopname" value="<#$shop.shopname#>"/>
                            	
                            </div>
                             <div class="field-box">
                                <label>联系人:</label>
                                <input class="span8" type="text" name="linker" id="linker" value="<#$shop.linker#>"/>
                            </div>
                              <div class="field-box">
                                <label>手机号码:</label>
                                <input class="span8" type="text" name="phone" id="phone" value="<#$shop.phone#>" />
                            </div>
                            <div class="field-box">
                                <label>路由注册上限:</label>
                                
                                 <div class="span8">
                                    <label class="radio">
                                    <input type="radio" name="linkflag" value="0" <eq name="shop['linkflag']" value="0">checked</eq>>限制(免费注册用户)
                                        	
                                    </label>
                                    <label class="radio">
                                               <input type="radio" name="linkflag" value="1" <eq name="shop['linkflag']" value="1">checked</eq>>不限制(付费用户或代理商开户)
                                        		
                                    </label>
                                </div>              
              
                       
                   
                            </div>
                             <div class="field-box">
                                <label>路由注册上限:</label>
                                <input class="span8" type="text" name="maxcount" id="maxcount" value="<#$shop.maxcount#>" />
                            </div>
                             <div class="field-box">
                                <label>消费水平:</label>
                                 <volist name="enumdata.shoplevel" id="vo">
                                    <label class="checkbox">
				                    <input type="checkbox" value="<#$vo.key#>" name="shoplevel" <php>if(strpos($shop['shoplevel'],"#".$vo['key']."#")>-1){echo "checked";} </php>/><#$vo.txt#>
				                    </label>
                    			</volist>
                                
                               
                            </div>
                             <div class="field-box">
                                <label>行业类别:</label>
                                 <volist name="enumdata.trades" id="vo">
                                 
                                <label class="checkbox">
                                   <input type="radio" value="<#$vo.key#>" name="trade" <php>if($shop['trade']==$vo['key']){echo "checked";} </php>/>
								   <#$vo.txt#>
                                </label>
                    
                    			</volist>
                                
                               
                               
                            </div>
                               <div class="field-box">
                                <label>所属商圈:</label>
                                <div class="ui-select">
                                    <select name="province" id="province"></select>
                                </div>
                                <div class="ui-select">
                                   <select name="city" id="city" ><option value="市辖区">市辖区</option><option value="市辖县">市辖县</option></select>
                                </div>
                                <div class="ui-select">
                                    <select name="area" id="area" ></select>
                 
                                </div>
                            </div>
                             <div class="field-box">
                                <label>地址:</label>
                                <input class="span8" type="text"  data-toggle="tooltip" data-trigger="focus" title="输入商铺所在地址" data-placement="right" name="address" id="address" value="<#$shop.address#>"/>
                            </div>
                              <div class="field-box ">
                              
                              <input type="hidden" name="sid" id="sid" value="<#$shop.id#>">
                               
                                <input type="button"   class="btn-glow primary "  id="btn_save" value="确认编辑">
                               &nbsp;&nbsp;
                               <input type="button"   class="btn-glow  " id="btn_back" value="返回列表">
                              
                              
                            </div>
                        </form>
                    </div>

                    <!-- right column -->
                    <div class="span4 column pull-right">

                    </div>
                </div>
            </div>
        </div>
    </div>


	<!-- scripts -->
    <script src="<#$Theme['P']['js']#>/jquery.js"></script>
    <script src="<#$Theme['P']['root']#>/bootadmin/js/bootstrap.min.js"></script>
    <script src="<#$Theme['P']['root']#>/bootadmin/js/theme.js"></script>
     <script src="<#$Theme['P']['root']#>/bootadmin/js/jquery.uniform.min.js"></script>
  <script src="<#$Theme['P']['root']#>/bootadmin/js/common.js"></script>
           <script src="<#$Theme['P']['js']#>/region_select.js"></script>
                    <script type="text/javascript">
                        new PCAS('province', 'city', 'area', '<#$shop['province']#>', '<#$shop.city#>', '<#$shop.area#>');
                    </script>
<!-- call this page plugins -->
    <script type="text/javascript">
    	
    	 
        $(function () {
        	
            // add uniform plugin styles to html elements
            $("input:checkbox, input:radio").uniform();
            $('#btn_back').bind('click',function(){
				location.href="<#:U('index')#>";
			});
            //$(".alert").alert('close');
			$('#btn_save').bind('click',function(){

				var s=$('#shopname').val();
				var link=$('#linker').val();
				var phone=$('#phone').val();
				var pro=$('#province').val();
				var city=$('#city').val();
				var area=$('#area').val();
				var ad=$('#address').val();
				var sid=$('#sid').val();
				var linkflag=$("input[name='linkflag']:checked").val();
				var max=$('#maxcount').val();
                var agent=$('#pid').val();
				var shoplevel="";
				$("input[name='shoplevel']").each(function(){
					if($(this).parent().hasClass('checked')){
						shoplevel+="#"+$(this).val()+"#";
					}
				});
				var trade="";
				$("input[name='trade']").each(function(){
					if($(this).parent().hasClass('checked')){
						trade=$(this).val();
					}
				});
				

				  if (s == "") {
					  AlertTips("商户名称不能为空",1500);
				        return false;
				  }
				  if (link == "") {
					  
					  AlertTips("联系人不能为空",1500);
				        return false;
				  }
				 if(!isPhone(phone)){
	
					  AlertTips("请输入11位手机号码",1500);
				        return false;
				 }
				  if (max == "") {
					  AlertTips("注册人数上限不能为空",1500);
				        return false;
				  }
				  if(!isNums(max)){
					  AlertTips("注册人数上限必须是数字",1500);
				        return false;
					}
					if(max=="0"){
						  AlertTips("注册人数上限必须大于0",1500);
					        return false;
						}
				  $.ajax({
					  	url: '<#:U('editshop')#>',
				        type: "post",
						data:{
							'shopname':s,
							'linker':link,
							'phone':phone,
							'province':pro,
							'city':city,
							'area':area,
							'address':ad,
							'shoplevel':shoplevel,
							'trade':trade,
							'maxcount':max,
							'linkflag':linkflag,
							'pid':agent,
							'id':sid,
							'__hash__':$('input[name="__hash__"]').val()
							},
						dataType:'json',
						error:function(){
			
								AlertTips("服务器忙，请稍候再试",1500);
								},
						success:function(data){
								
								if(data.error==0){
									location.href=data.url;
								}else{
									AlertTips(data.msg,1500);
								}
						}
					  });
				});
            
        });
    </script>








</body>
</html>